var cur={type:null,num:0,arrX:null,arrY:null,color:null,state:0,spawn:function(){cur.type=nextCur.type,cur.num=nextCur.num,cur.arrX=nextCur.arrX,cur.arrY=nextCur.arrY,cur.color=nextCur.color,cur.state=nextCur.state,nextCur.spawn()}},nextCur={type:null,num:0,arrX:null,arrY:null,color:null,colors:["red","yellow","blue","green","white","aqua","violet","tomato"],state:0,spawn:function(){var r=["S","Z","L","J","I","O","T"];switch(nextCur.type=r[Math.round(100*Math.random())%7],function(r){nextCur.num=r,nextCur.arrX=new Array,nextCur.arrY=new Array,nextCur.color=nextCur.colors[Math.round(100*Math.random())%nextCur.colors.length]}(4),nextCur.type){case"S":nextCur.arrX[0]=5,nextCur.arrY[0]=-2,nextCur.arrX[1]=4,nextCur.arrY[1]=-2,nextCur.arrX[2]=4,nextCur.arrY[2]=-1,nextCur.arrX[3]=3,nextCur.arrY[3]=-1;break;case"Z":nextCur.arrX[0]=4,nextCur.arrY[0]=-2,nextCur.arrX[1]=5,nextCur.arrY[1]=-2,nextCur.arrX[2]=5,nextCur.arrY[2]=-1,nextCur.arrX[3]=6,nextCur.arrY[3]=-1;break;case"L":nextCur.arrX[0]=5,nextCur.arrY[0]=-2,nextCur.arrX[1]=5,nextCur.arrY[1]=-1,nextCur.arrX[2]=4,nextCur.arrY[2]=-1,nextCur.arrX[3]=3,nextCur.arrY[3]=-1;break;case"J":nextCur.arrX[0]=4,nextCur.arrY[0]=-2,nextCur.arrX[1]=4,nextCur.arrY[1]=-1,nextCur.arrX[2]=5,nextCur.arrY[2]=-1,nextCur.arrX[3]=6,nextCur.arrY[3]=-1;break;case"I":nextCur.arrX[0]=3,nextCur.arrY[0]=-1,nextCur.arrX[1]=4,nextCur.arrY[1]=-1,nextCur.arrX[2]=5,nextCur.arrY[2]=-1,nextCur.arrX[3]=6,nextCur.arrY[3]=-1;break;case"O":nextCur.arrX[0]=4,nextCur.arrY[0]=-2,nextCur.arrX[1]=5,nextCur.arrY[1]=-2,nextCur.arrX[2]=4,nextCur.arrY[2]=-1,nextCur.arrX[3]=5,nextCur.arrY[3]=-1;break;case"T":nextCur.arrX[0]=4,nextCur.arrY[0]=-2,nextCur.arrX[1]=3,nextCur.arrY[1]=-1,nextCur.arrX[2]=4,nextCur.arrY[2]=-1,nextCur.arrX[3]=5,nextCur.arrY[3]=-1}}},gameEnv={left:function(){for(var r=0;r<cur.num;r++){var e=null!=game.scene[cur.arrY[r]]&&null!=game.scene[cur.arrY[r]][cur.arrX[r]-1];if(cur.arrX[r]<=0||e)return}for(var a=0;a<cur.num;a++)cur.arrX[a]--},right:function(){for(var r=0;r<cur.num;r++){var e=null!=game.scene[cur.arrY[r]]&&null!=game.scene[cur.arrY[r]][cur.arrX[r]+1];if(cur.arrX[r]>=9||e)return}for(var a=0;a<cur.num;a++)cur.arrX[a]++},up:function(){if("O"!=cur.type){cur.state=(cur.state+1)%4;var r=new Array,e=new Array;switch(cur.type){case"S":0==cur.state?(r[0]=cur.arrX[0]+2,e[0]=cur.arrY[0],r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]-1):1==cur.state?(r[0]=cur.arrX[0],e[0]=cur.arrY[0]+2,r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]-1):2==cur.state?(r[0]=cur.arrX[0]-2,e[0]=cur.arrY[0],r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]+1):3==cur.state&&(r[0]=cur.arrX[0],e[0]=cur.arrY[0]-2,r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]+1);break;case"Z":0==cur.state?(r[0]=cur.arrX[0],e[0]=cur.arrY[0]-2,r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]+1):1==cur.state?(r[0]=cur.arrX[0]+2,e[0]=cur.arrY[0],r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]+1):2==cur.state?(r[0]=cur.arrX[0],e[0]=cur.arrY[0]+2,r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]-1):3==cur.state&&(r[0]=cur.arrX[0]-2,e[0]=cur.arrY[0],r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]-1);break;case"L":0==cur.state?(r[0]=cur.arrX[0]+2,e[0]=cur.arrY[0],r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]-1):1==cur.state?(r[0]=cur.arrX[0],e[0]=cur.arrY[0]+2,r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]-1):2==cur.state?(r[0]=cur.arrX[0]-2,e[0]=cur.arrY[0],r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]+1):3==cur.state&&(r[0]=cur.arrX[0],e[0]=cur.arrY[0]-2,r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]+1);break;case"J":0==cur.state?(r[0]=cur.arrX[0],e[0]=cur.arrY[0]-2,r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]+1):1==cur.state?(r[0]=cur.arrX[0]+2,e[0]=cur.arrY[0],r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]+1):2==cur.state?(r[0]=cur.arrX[0],e[0]=cur.arrY[0]+2,r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]-1):3==cur.state&&(r[0]=cur.arrX[0]-2,e[0]=cur.arrY[0],r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]-1);break;case"I":0==cur.state?(r[0]=cur.arrX[0]-2,e[0]=cur.arrY[0]-2,r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]+1):1==cur.state?(r[0]=cur.arrX[0]+2,e[0]=cur.arrY[0]-2,r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]+1):2==cur.state?(r[0]=cur.arrX[0]+2,e[0]=cur.arrY[0]+2,r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]-1):3==cur.state&&(r[0]=cur.arrX[0]-2,e[0]=cur.arrY[0]+2,r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]-1);break;case"T":0==cur.state?(r[0]=cur.arrX[0]+1,e[0]=cur.arrY[0]-1,r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]+1):1==cur.state?(r[0]=cur.arrX[0]+1,e[0]=cur.arrY[0]+1,r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]-1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]+1):2==cur.state?(r[0]=cur.arrX[0]-1,e[0]=cur.arrY[0]+1,r[1]=cur.arrX[1]+1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]-1,e[3]=cur.arrY[3]-1):3==cur.state&&(r[0]=cur.arrX[0]-1,e[0]=cur.arrY[0]-1,r[1]=cur.arrX[1]-1,e[1]=cur.arrY[1]+1,r[3]=cur.arrX[3]+1,e[3]=cur.arrY[3]-1)}--cur.state,r[0]<0||r[0]>9||r[1]<0||r[1]>9||r[3]<0||r[3]>9||e[0]>19||e[1]>19||e[3]>19||null!=game.scene[e[0]]&&null==game.scene[e[0]][r[0]]&&null!=game.scene[e[1]]&&null==game.scene[e[1]][r[1]]&&null!=game.scene[e[3]]&&null==game.scene[e[3]][r[3]]&&(cur.arrX[0]=r[0],cur.arrY[0]=e[0],cur.arrX[1]=r[1],cur.arrY[1]=e[1],cur.arrX[3]=r[3],cur.arrY[3]=e[3],++cur.state)}},down:function(){for(var r=0;r<cur.num;r++){var e=null!=game.scene[cur.arrY[r]+1]&&null!=game.scene[cur.arrY[r]+1][cur.arrX[r]];if(cur.arrY[r]>=19||e)return gameEnv.finish(),!0}for(var a=0;a<cur.num;a++)cur.arrY[a]++},downMax:function(){for(;1!=gameEnv.down(););},finish:function(){for(var r=0;r<cur.num;r++)if(cur.arrY[r]<0)return void game.over();for(var e=0;e<cur.num;e++)game.scene[cur.arrY[e]][cur.arrX[e]]=cur.color;cur.spawn();var a=0;r:for(var u=19;u>a;u--){for(var c=0;c<10;c++)if(null==game.scene[u][c])continue r;if(u>++a)for(var t=u-1;t>a;t--)game.scene[t+1]=game.scene[t];else for(var n=0;n<10;n++)game.scene[u][n]=null;++u}switch(a){case 1:game.scope+=100;break;case 2:game.scope+=200;break;case 3:game.scope+=400;break;case 4:game.scope+=800}}},game={cvs:null,ctx:null,time:0,speed:10,dSpeed:10,size:20,minX:140,minY:100,maxX:320,maxY:480,scope:0,isPause:!0,scene:null,init:function(r){null==game.cvs&&(game.cvs=r,game.ctx=r.getContext("2d")),game.bg(),game.ctx.fillStyle="rgba(255, 255, 255, 0.2)",game.ctx.fillRect(0,0,480,600),game.ctx.fillStyle="aqua",game.ctx.font="24px 宋体",game.ctx.fillText("开始游戏",190,300),game.cvs.onclick=function(r){r.offsetX>180&&r.offsetX<290&&r.offsetY>270&&r.offsetY<310&&(game.run(),nextCur.spawn(),cur.spawn(),game.cvs.onclick=function(r){var e=r.offsetX>40&&r.offsetX<80&&r.offsetY>165&&r.offsetY<210,a=r.offsetX>40&&r.offsetX<80&&r.offsetY>265&&r.offsetY<310,u=r.offsetX<45&&r.offsetY>215&&r.offsetY<260,c=r.offsetX>70&&r.offsetX<110&&r.offsetY>215&&r.offsetY<260,t=r.offsetX>40&&r.offsetX<80&&r.offsetY>315&&r.offsetY<360,n=r.offsetX>20&&r.offsetX<100&&r.offsetY>55&&r.offsetY<130;e?gameEnv.up():a?gameEnv.down():u?gameEnv.left():c?gameEnv.right():t?gameEnv.downMax():n&&game.pause()})},game.scope=0,game.speed=game.dSpeed,game.time=0,game.scene=new Array;for(var e=0;e<20;e++)game.scene[e]=new Array},gameKeyEnv:function(r){97==r.keyCode||65==r.keyCode?gameEnv.left():100==r.keyCode||68==r.keyCode?gameEnv.right():119==r.keyCode||87==r.keyCode?gameEnv.up():115==r.keyCode||83==r.keyCode?gameEnv.down():118!=r.keyCode&&86!=r.keyCode||gameEnv.downMax()},num:0,start:function(){game.bg(),game.ctx.fillStyle="white",game.ctx.fillText("分数:"+game.scope,120,60),game.ctx.fillText("坚持时间:"+Math.round(game.time),250,60),game.ctx.fillStyle=cur.color;for(var r=0;r<cur.num;r++)game.ctx.fillRect(game.minX+game.size*cur.arrX[r],game.minY+game.size*cur.arrY[r],game.size,game.size);game.ctx.fillStyle=nextCur.color;for(var e=0;e<nextCur.num;e++)game.ctx.fillRect(game.minX+180+game.size*nextCur.arrX[e],game.minY+game.size*nextCur.arrY[e],game.size,game.size);for(var a=0;a<game.scene.length;a++)for(var u=0;u<game.scene[a].length;u++)null!=game.scene[a][u]&&(game.ctx.fillStyle=game.scene[a][u],game.ctx.fillRect(game.minX+u*game.size,game.minY+a*game.size,game.size,game.size));game.num++==game.speed&&(game.num=0,gameEnv.down(),2!=game.speed&&(game.speed=10-Math.round(game.time/30))),game.time+=.05,game.isPause||setTimeout("game.start()",50)},pause:function(r){function e(){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}(function(){game.isPause=!0,window.onkeypress=null,pause()}),run:function(){0!=game.isPause&&(game.isPause=!1,game.start(),window.onkeypress=game.gameKeyEnv)},over:function(r){function e(){return r.apply(this,arguments)}return e.toString=function(){return r.toString()},e}(function(){game.isPause=!0,window.onkeypress=null,over(game.scope)}),bg:function(){game.ctx.fillStyle="black",game.ctx.fillRect(0,0,480,600),game.ctx.fillStyle="#9ba7ba",game.ctx.fillRect(120,80,20,440),game.ctx.fillRect(340,80,20,440),game.ctx.fillRect(140,80,200,20),game.ctx.fillRect(140,500,200,20),game.ctx.fillStyle="green",game.ctx.fillRect(41,168,40,40),game.ctx.fillRect(41,268,40,40),game.ctx.fillRect(41,320,40,40),game.ctx.fillRect(5,218,40,40),game.ctx.fillRect(72,218,40,40),game.ctx.fillRect(20,90,80,40),game.ctx.fillStyle="red",game.ctx.font="22px 宋体 bold",game.ctx.fillText("↑W",44,200),game.ctx.fillText("↓S",46,300),game.ctx.fillText("↓|V",44,350),game.ctx.fillText("←A",5,250),game.ctx.fillText("→D",73,250),game.ctx.fillText("暂停",38,120)}};